# dhruva-slam-node configuration
#
# This file configures the dead reckoning odometry daemon.

[source]
# SangamIO daemon address (robot IP:port)
sangam_address = "192.168.68.101:5555"

[output]
# TCP port for visualization clients (Drishti connects here)
bind_port = 5557
# Output rate in Hz (decimated from 110Hz input)
odometry_rate_hz = 50
# SLAM status/diagnostics rate (Hz)
slam_status_rate_hz = 5.0
# SLAM map publishing rate (Hz)
slam_map_rate_hz = 1.0

[odometry]
# Encoder ticks per meter of wheel travel
# Calibrated: linear push test average = 4464 ticks/m
ticks_per_meter = 4464.0

# Distance between wheel centers in meters
# Physical measurement: (24.8 + 21.5) / 2 = 23.15cm
wheel_base = 0.233

# Complementary filter gyro weight (0.0 to 1.0)
# Higher values trust gyroscope more
# 0.8 gives good balance - encoder dominates long-term, gyro smooths short-term
alpha = 0.8

# Gyroscope scale factor (raw units to rad/s)
# CRL-200S IMU: raw units are 0.01 deg/s
# Convert to rad/s: 0.01 × (π/180) = 0.0001745
gyro_scale = 0.0001745

# Gyroscope Z bias in raw units
# Auto-calibrated at startup (330 samples ~3 seconds)
gyro_bias_z = 0.0

[slam]
# Enable SLAM processing
enabled = true
# Initial mode: "Mapping", "Localization", or "Idle"
initial_mode = "Mapping"
# Lidar range filter (meters)
min_range = 0.15
max_range = 8.0

[lidar]
# Lidar offset configuration (follows TF transform convention like GMapping, Cartographer)
# Coordinate frame: X=forward, Y=left, Theta=CCW (ROS REP-103)
#
# Calibrated using Python ICP tool (tools/icp_calibration.py) on rotate_3min.bag

# 1. Lidar housing mounting position relative to robot center (meters)
#    This is robot-specific - measured from robot center to lidar housing center
mounting_x = -0.0936  # 93.6mm behind robot center (calibrated)
mounting_y = 0.0      # Centered on robot axis

# 2. Optical center offset (meters) - RADIAL
#    Distance from lidar housing geometric center to actual laser origin (rotating scanner)
#    This is a RADIAL offset - added to each range measurement along the laser beam direction
#    It corrects for the scanner being offset from the housing center, not a fixed X/Y translation
optical_offset = 0.0258  # 25.8mm radial offset (calibrated)

# 3. Angular offset (radians)
#    Rotation of lidar's 0° relative to robot forward
#    Positive = CCW when viewed from above
angle_offset = 0.0
