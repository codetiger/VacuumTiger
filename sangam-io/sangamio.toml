# SangamIO Configuration
# Hardware abstraction daemon for CRL-200S robot vacuum
#
# This file configures the SangamIO daemon that runs on the robot.
# Deploy to /etc/sangamio.toml on the target device.

[device]
# Device type - determines which driver to load
# Currently supported: "crl200s"
type = "crl200s"

# Human-readable device name (for logging)
name = "CRL-200S Vacuum Robot"

[device.hardware]
# Serial port for GD32F103 motor controller
# Default on CRL-200S: /dev/ttyS3
# Baud rate: 115200 (fixed in firmware)
gd32_port = "/dev/ttyS3"

# Serial port for Delta-2D lidar sensor
# Default on CRL-200S: /dev/ttyS1
# Baud rate: 115200 (fixed in firmware)
lidar_port = "/dev/ttyS1"

# GD32 heartbeat interval in milliseconds
# CRITICAL: Must be 20-50ms or motors will stop (hardware watchdog)
# Recommended: 20 (provides safety margin)
# See src/devices/crl200s/gd32/heartbeat.rs for details
heartbeat_interval_ms = 20

# Lidar motor PWM duty cycle (0-100%)
# Controls the speed of the lidar motor
# Higher values = faster rotation = higher scan rate
# Default: 60 (provides ~330 RPM / 5.5 Hz scan rate)
lidar_pwm = 60

# Coordinate frame transforms (ROS REP-103)
# Transforms raw sensor data to standard robot frame:
#   X = forward (direction robot drives)
#   Y = left (port side)
#   Z = up
#   Angles = counter-clockwise (CCW) positive
#
# All transforms default to identity (no change) if not specified.

[device.hardware.frame_transforms]

# Lidar angle transform: output = scale * input + offset
# CRL-200S: mounted backward (offset=π), clockwise angles (scale=-1)
[device.hardware.frame_transforms.lidar]
scale = -1.0           # -1 converts CW to CCW
offset = 3.14159265    # π radians = 180° rotation for backward mount

# IMU gyroscope axis remap: [source_axis, sign]
# CRL-200S hardware: x=yaw, y=pitch, z=roll
# ROS standard:      x=roll, y=pitch, z=yaw
[device.hardware.frame_transforms.imu_gyro]
x = [2, 1]    # output_x (roll) = input_z * 1
y = [1, 1]    # output_y (pitch) = input_y * 1
z = [0, -1]   # output_z (yaw) = input_x * -1 (sign flip)

# IMU accelerometer axis remap (identity for CRL-200S)
# [device.hardware.frame_transforms.imu_accel]
# x = [0, 1]
# y = [1, 1]
# z = [2, 1]

[network]
# TCP server bind address for command connections
# Format: "host:port"
# Use "0.0.0.0:5555" to listen on all interfaces
# TCP is commands-only + triggers UDP streaming registration
bind_address = "0.0.0.0:5555"

# UDP streaming port for sensor data (unicast to registered clients)
# When a TCP client connects, their IP is registered for UDP streaming
# Sensor data is sent to <client_ip>:<udp_streaming_port>
# Default: 5556
udp_streaming_port = 5556
